{"version":3,"sources":["assets\\Script\\GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Common, { inGameState } from \"./Common\";\nimport GameConfig from \"./GameConfig\";\nimport LineManager from \"./LineManager\";\nimport SoundManager from \"./UI/SoundManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n    \n    @property(cc.Label)\n    lbgameOver: cc.Label = null;\n    \n    @property(cc.Label)\n    lbgameWon: cc.Label = null;\n    \n    // @property(cc.Node)\n    // obstacle: cc.Node = null;\n\n\n    // @property(cc.Prefab)\n    // linePrefabs: cc.Prefab = null;\n\n    // @property(cc.Node)\n    // canvas: cc.Node = null;\n    \n    // @property(cc.Prefab)\n    // prefabToSpawn: cc.Prefab = null;\n    \n    @property(cc.Label)\n    timeStart:cc.Label = null;\n    \n    // deltaTime: number = 1;\n    // timeSinceLastSpawn: number = 0;\n    // lastSpawnPosition: cc.Vec2 = null;\n    // gameTime : number = 0;\n    // currentTime: number = 10;\n    // uiManager: UIManager = null;\n    \n    // isGameOver: boolean = false;\n    // canSpawn: boolean = true;\n    \n    @property(cc.Prefab)\n    public brushPrefab: cc.Prefab = null;\n\n    @property(cc.SpriteFrame)\n    public brush: cc.Sprite = null;\n\n    public reachLevel : number = 58; \n    \n    private maxLevel: number = 300;\n    countValue = 0;\n    private timeCheck : number;\n    lineMgr : LineManager = null;\n    \n    // levelNode:cc.Node = null;\n    \n    @property(cc.Node)\n    private toggleWallNode: cc.Node = null;\n    @property(cc.Node)\n    private levelContainer: cc.Node = null;\n    @property(cc.Prefab)\n    leftParticlePrefabs: cc.Prefab = null;\n    @property(cc.Prefab)\n    rightParticlePrefabs: cc.Prefab = null;\n    @property(cc.Node)\n    leftFireworkContainer: cc.Node = null;\n    @property(cc.Node)\n    rightFireworkContainer: cc.Node = null;\n    @property(cc.Node)\n    nextLevelButton: cc.Node = null\n    @property(cc.Node)\n    completeDlg: cc.Node = null;\n    \n    @property(cc.Prefab)\n    aniFailPrefab: cc.Prefab = null;\n\n    @property(cc.Prefab)\n    aniWinPrefab: cc.Prefab = null;\n    \n    @property(cc.Label)\n    levelText: cc.Label = null;\n    @property(cc.Label)\n    hintText: cc.Label = null;\n    \n    leftParticle: cc.Node ;\n    rightParticle: cc.Node;\n    \n    \n    public static _ins: GameManager;\n    \n    public static get instance(): GameManager {\n        return this._ins || new GameManager;\n    }\n    // LIFE-CYCLE CALLBACKS:\n    \n    onLoad () {\n        GameManager._ins = this;\n        cc.director.getPhysicsManager().enabled = true;\n        cc.director.getCollisionManager().enabled = true;\n        \n        this.nextLevelButton.on('click', this.NextLevel, this);\n    }\n    \n    start () {\n        GameManager._ins.loadLevel(this.reachLevel);\n    }\n\n    update(dt: number) {\n        {\n            if(GameConfig.gameState == inGameState.CHECKING)\n            {\n                this.countValue += dt;\n                if(this.countValue > 1)\n                {\n                    this.countValue = 0;\n                    this.timeCheck -= 1;\n                    this.updateTimeDisplay()\n                }\n            }\n            else if(GameConfig.gameState == inGameState.FAILED)\n            {\n                GameConfig.gameState = inGameState.NONE;\n                Common.instance.node.emit(\"FailLevelEvent\");\n            }\n        }\n    }\n    \n    updateTimeDisplay()\n    {\n        this.timeStart.string = this.timeCheck + \"\";\n        if(this.timeCheck == 0)\n        {\n            this.CheckIsMeetTargetLevel();\n            if(!this.lineMgr.isMeetTargetLevel)\n            {\n                console.log(\"on node active false\");\n                this.timeStart.node.active = false;\n                GameConfig.gameState = inGameState.COMPLETED;\n                Common._ins.node.emit(\"PassLevelEvent\");\n            }else\n            {\n                GameConfig.gameState = inGameState.FAILED;\n            }\n        }\n    }\n    CheckIsMeetTargetLevel(): void{\n        if(this.reachLevel == 41 || this.reachLevel == 46 || this.reachLevel == 63 || this.reachLevel == 64\n            || this.reachLevel == 65 || this.reachLevel == 66 || this.reachLevel == 67 || this.reachLevel == 68 \n            || this.reachLevel == 70 || this.reachLevel == 78 || this.reachLevel == 79 || this.reachLevel == 80){\n            this.lineMgr.isMeetTargetLevel = true;\n        }\n        else{\n            this.lineMgr.isMeetTargetLevel = false;;\n        }\n    }\n    startCounting(timeCheck: number)\n    {\n        this.timeCheck = timeCheck;\n        this.timeStart.node.active = true;\n        this.updateTimeDisplay();\n    }\n    private NextLevel() {\n        GameConfig.sessionNumber += 1;\n        this.loadLevel(this.reachLevel + 1);\n        this.completeDlg.active = false;\n    }\n    onCompleteAni()\n    {\n        SoundManager.instance.PlayDoneLevel();\n        this.scheduleOnce(function() \n        {\n            this.leftParticle = cc.instantiate(this.leftParticlePrefabs);\n            this.rightParticle = cc.instantiate(this.rightParticlePrefabs)\n            this.rightParticle.parent = this.rightFireworkContainer;\n            this.leftParticle.parent = this.leftFireworkContainer;\n            this.leftParticle.position = cc.Vec2.ZERO;\n            this.rightParticle.position = cc.Vec2.ZERO;\n        },0.2);\n\n        this.scheduleOnce(function()\n        {\n            if(this.leftParticle !== null || this.rightParticle !== null)\n            {\n                this.leftParticle.destroy();\n                this.rightParticle.destroy();\n            }\n        },2.2)\n    }\n\n    onCompleteLevel()\n    {\n        this.onCompleteAni()\n        this.scheduleOnce(function()\n        {\n            // if(this.reachLevel < this.maxLevel)\n            // {\n                this.timeStart.node.active = false;\n                this.completeDlg.active = true;\n            // }\n        },3)\n    }\n\n    loadLevel(levelNum: number)\n    {\n        let self = this;\n        if (levelNum >= 300) return;\n        let LevelIndex = levelNum > 200 ? GameConfig.LevelOrder[levelNum - 200] : levelNum;\n        cc.resources.load(`LevelPrefab/Level${LevelIndex}`, function(err , prefab: cc.Prefab)\n        {\n            if(err)\n            {\n                self.loadLevel(LevelIndex + 1);\n            }\n            else{\n                GameManager.instance.onCheckingLevel(prefab,LevelIndex);\n            }\n        })\n    }\n    onCheckingLevel(prefab: cc.Prefab, levelId: number)\n    {\n        this.reachLevel = levelId;\n        this.levelText.string = \"LEVEL \" +`${levelId}`;\n        let levelNode = cc.instantiate(prefab);\n        levelNode.name = `LEVEL${levelId}`;\n        if(this.lineMgr != null)\n        {\n            cc.resources.release(`LevelPrefab/Level${this.reachLevel-1}`);\n            this.lineMgr.node.destroy();\n        }\n        this.lineMgr = levelNode.getComponent(LineManager);\n        this.toggleWallNode.active = this.lineMgr.isToggleOnWall;\n        this.levelContainer.addChild(levelNode);\n        levelNode.setPosition(0,0,0);\n        this.hintText.string = this.lineMgr.hintText;\n        GameConfig.gameState = inGameState.PLAYING;\n    }\n\n    restartLevel() {\n        let self = this;\n        this.timeStart.node.active = false;\n        GameManager.instance.loadLevel(self.reachLevel);\n    }\n\n}\n"]}